(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=function(){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,r),n(this,"x",0),n(this,"y",0),n(this,"z",0),this.x=e,this.y=i,this.z=a}var i,a;return i=r,a=[{key:"sub",value:function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}},{key:"add",value:function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}},{key:"multiplyScalar",value:function(t){return new r(this.x*t,this.y*t,this.z*t)}},{key:"divideScalar",value:function(t){return new r(this.x/t,this.y/t,this.z/t)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}}],a&&e(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),r}();function i(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function a(t,e){return new r(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}function o(t){return t.divideScalar(t.length())}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.origin=e,this.direction=n}var e,n;return e=t,(n=[{key:"origin",value:function(){return this.origin}},{key:"direction",value:function(){return this.direction}},{key:"at",value:function(t){return this.origin.add(this.direction.multiplyScalar(t))}}])&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"ambient",value:function(t){this.type="ambient",this.intensity=t}},{key:"point",value:function(t,e){this.type="point",this.intensity=t,this.position=e}},{key:"directional",value:function(t,e){this.type="directional",this.intensity=t,this.direction=e}}],null&&c(e.prototype,null),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var y=h((function t(e,n,r,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.center=e,this.radius=n,this.color=r,this.shine=i,this.reflective=a}));function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var d=v((function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.spheres=e,this.lights=n,this.tMin=r,this.tMax=i}));function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var m,g,S,x,k,z,j,O,P,C,I=w((function t(e,n,r,i,l){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.look=e,this.lookat=n,this.vup=r,this.vfov=i,this.aspectRatio=l;var u=i*(Math.PI/180),c=2*Math.tan(u/2),s=l*c,f=o(e.sub(n)),h=o(a(r,f)),y=a(f,h);this.origin=e,this.horizontal=h.multiplyScalar(s),this.vertical=y.multiplyScalar(c),this.lowerLeftCorner=this.origin.sub(this.horizontal.divideScalar(2)).sub(this.vertical.divideScalar(2)).sub(f)}));function M(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}for(var E=document.getElementById("canvas"),T=parseInt(288),q=new Uint8ClampedArray(2048*T),L=new I(new r(1,.5,4),new r(.5,0,-1),new r(0,1,0),20,16/9),B=[new s.ambient(.3),new s.point(.5,new r(1,1,0)),new s.directional(.2,new r(1,4,4))],D=new d([new y(new r(-.3,.1,-1),.5,new r(.8,.7,.5),65,0),new y(new r(.7,.1,-1),.4,new r(.5,.3,.2),.3,.4),new y(new r(1.5,0,-.75),.25,new r(.5,.4,.5),65,.1),new y(new r(0,-100.5,-1),100,new r(.1,.9,.1),65,0)],B,.001,1/0),U=performance.now(),F=511;F>=0;F--)for(var H=0;H<512;H++){var R=H/511,$=F/(T-1);m=q,g=H,S=F,x=N(new u(L.origin,L.lowerLeftCorner.add(L.horizontal.multiplyScalar(R)).add(L.vertical.multiplyScalar($)).sub(L.origin)),D,3),k=512,z=T,j=void 0,O=void 0,P=void 0,C=void 0,j=parseInt(255.99*x.x),O=parseInt(255.99*x.y),P=parseInt(255.99*x.z),m[(C=4*((z-1-S)*k+g))+0]=j,m[C+1]=O,m[C+2]=P,m[C+3]=255}!function(t,e,n,r){t.setAttribute("width",512),t.setAttribute("height",r);var i=t.getContext("2d"),a=new ImageData(e,512,r);i.putImageData(a,0,0)}(E,q,0,T);var G=(performance.now()-U)/1e3;function J(t,e){var n=e.origin.sub(t.center),r=i(e.direction,e.direction),a=2*i(n,e.direction),o=a*a-4*r*(i(n,n)-t.radius*t.radius);return o<0?-1:[(-a-Math.sqrt(o))/(2*r),(-a+Math.sqrt(o))/(2*r)]}function K(t,e){var n,r=e.tMin,i=e.tMax,a=1/0,o=null,l=M(e.spheres);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=J(u,t);c[0]<a&&c[0]<=i&&c[0]>=r&&(a=c[0],o=u),c[1]<a&&c[1]<=i&&c[1]>=r&&(a=c[1],o=u)}}catch(t){l.e(t)}finally{l.f()}return{tClosest:a,closestSphere:o}}function N(t,e,n){var a=e.lights,l=K(t,e),c=l.tClosest,s=l.closestSphere;if(null!=s){var f=t.at(c),h=o(f.sub(s.center)),y=s.color,p=function(t,e,n,r,a,l){var c,s=0,f=M(r);try{for(f.s();!(c=f.n()).done;){var h=c.value;if("ambient"==h.type)s+=h.intensity;else{var y=void 0;if("point"==h.type?y=h.position.sub(t):"directional"==h.type&&(y=h.direction),null!=K(new u(t,o(y.sub(t))),l).closestSphere)continue;var p=i(e,y);if(p>0&&(s+=h.intensity*p/(e.length()*y.length())),null!=a.shine){var v=e.multiplyScalar(2).multiplyScalar(i(e,y)).sub(y),d=i(v,n);d>0&&(s+=h.intensity*Math.pow(d/(v.length()*n.length()),a.shine))}}}}catch(t){f.e(t)}finally{f.f()}return s}(f,h,t.direction.multiplyScalar(-1),a,s,e),v=y.multiplyScalar(p),d=s.reflective;if(n<=0||d<=0)return v;var b=function(t,e){return t.sub(e.multiplyScalar(2*i(t,e)))}(t.direction,h),w=N(new u(f,b),e,n-1);return v.multiplyScalar(1-d).add(w.multiplyScalar(d))}var m=.5*(o(t.direction).y+1);return new r(1,1,1).multiplyScalar(1-m).add(new r(.5,.7,1).multiplyScalar(m))}console.log("execute time: ".concat(G,"s")),document.getElementById("exetime").innerHTML+=" ".concat(G.toFixed(2),"s")})();